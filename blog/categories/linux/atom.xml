<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: linux | 脑波网]]></title>
  <link href="http://dexterdeng.github.com/blog/categories/linux/atom.xml" rel="self"/>
  <link href="http://dexterdeng.github.com/"/>
  <updated>2013-01-18T18:01:02+08:00</updated>
  <id>http://dexterdeng.github.com/</id>
  <author>
    <name><![CDATA[Dexter Deng]]></name>
    <email><![CDATA[dexterdeng@gmail.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[crontab issues with rvm ]]></title>
    <link href="http://dexterdeng.github.com/blog/2013/01/18/crontab-issues-with-rvm/"/>
    <updated>2013-01-18T17:45:00+08:00</updated>
    <id>http://dexterdeng.github.com/blog/2013/01/18/crontab-issues-with-rvm</id>
    <content type="html"><![CDATA[<p>I encountered these issues today.</p>

<ol>
<li>I can't set default rvm to different users. like hudson and nginx.</li>
</ol>


<p>solution:</p>

<pre><code>PATH=/usr/kerberos/sbin:/usr/local/rvm/gems/ree-1.8.7-2011.03/bin:/usr/local/rvm/gems/ree-1.8.7-2011.03@global/bin:/usr/local/rvm/rubies/ree-1.8.7-2011.03/bin:/usr/local/rvm/bin:/usr/kerberos/bin:/usr/local/bin:/bin:/usr/bin:/home/blabla/bin
[[ -s "/usr/local/rvm/scripts/rvm" ]] &amp;&amp; . "/usr/local/rvm/scripts/rvm" # Load RVM function
rvm ree-1.8.7-2011.03 --default
</code></pre>

<ol>
<li><p>after I did #1, I encountered another issue. nginx user can't run
crontab -l or crontab -l. it spotted  something like that:</p>

<p> user (nginx) are not allowed to access to (crontab) because of pam configuration</p></li>
</ol>


<p>solution:</p>

<pre><code>#
# The PAM configuration file for the cron daemon
#
#
#auth      sufficient pam_env.so          # Comment that line
#auth       required   pam_rootok.so    # Comment that line

auth       sufficient pam_rootok.so       # Add that line
auth       required   pam_env.so        # Add that line

auth       include    system-auth
account    required   pam_access.so
account    include    system-auth
session    required   pam_loginuid.so
session    include    system-auth
</code></pre>

<p>   and then, I can run crontab -e now.</p>

<ol>
<li>nginx can't use rvm stuff.</li>
</ol>


<p>solution.</p>

<pre><code>/usr/local/rvm/bin/rake-ree-1.8.7-2011.03 can run the rake tasks directly
</code></pre>

<p>  I added a task to edit crontab  , replace <code>/usr/bin/env ruby</code> with <code>/usr/local/rvm/bin/rake-ree-1.8.7-2011.03</code></p>

<pre><code>desc "correct crontab "
task :cron =&gt; :environment do
  oc = `crontab -l`
  #nrake = "/Users/mac/.rbenv/shims/rake"
  nrake = "/usr/local/rvm/bin/rake-ree-1.8.7-2011.03"
  oc = oc.split("\n").map{|l|
    l.gsub("/usr/bin/env rake", nrake)
  }
  cf = File.new("#{RAILS_ROOT}/tmp/nc.txt", "w")
  cf.puts oc.join("\n")
  cf.close

  `crontab &lt; #{RAILS_ROOT}/tmp/nc.txt`
end
</code></pre>

<p>  and then , I add this to deploy script.</p>

<pre><code>namespace :deploy do
desc "Update the crontab file"
  task :update_crontab, :roles =&gt; :db do
    run "cd #{release_path} &amp;&amp; whenever --update-crontab #{application} &amp;&amp; rake sys:cron RAILS_ENV=production"
  end
end 
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[install hudson]]></title>
    <link href="http://dexterdeng.github.com/blog/2013/01/16/install-hudson/"/>
    <updated>2013-01-16T16:58:00+08:00</updated>
    <id>http://dexterdeng.github.com/blog/2013/01/16/install-hudson</id>
    <content type="html"><![CDATA[<h4>亲信官方文档， 导致错误</h4>

<p>官方这么说： http://wiki.hudson-ci.org/display/HUDSON/Installing+Hudson+using+RPM+repository</p>

<pre><code>Installation
sudo wget -O /etc/yum.repos.d/hudson.repo http://hudson-ci.org/redhat/hudson.repo
sudo yum check-update
sudo yum install hudson
</code></pre>

<p>错！</p>

<p>第一行命令执行完， 得到一下结果：</p>

<pre><code>Loaded plugins: fastestmirror, security
Loading mirror speeds from cached hostfile
 * base: dist1.800hosting.com
 * epel: mirrors.servercentral.net
 * extras: mirror.rackspace.com
 * rpmforge: mirror.teklinks.com
 * updates: mirror.raystedman.net
hudson/primary_db                                                                                                                                           | 5.0 kB     00:00     
http://hudson-ci.org/redhat/repodata/f6063d9778b5261845bb4845b277fe48b0a24b657c9cd21e7fc37f017642bb5b-primary.sqlite.bz2: [Errno -3] Error performing checksum
Trying other mirror.
Error: failure: repodata/f6063d9778b5261845bb4845b277fe48b0a24b657c9cd21e7fc37f017642bb5b-primary.sqlite.bz2 from hudson: [Errno 256] No more mirrors to try.
</code></pre>

<p>无论执行何yum命令，都会出现这个结果。</p>

<p>解决：</p>

<pre><code>rm /etc/yum.repos.d/hudson.repo
</code></pre>

<p>删掉yum.repos.d里hudson记录即可</p>

<h3>继续，重新开始</h3>

<h4>安装JDK</h4>

<pre><code>yum search java #找到最新，java

yum install java-1.6.0-openjdk.x86_64 java-1.6.0-openjdk-devel.x86_64
</code></pre>

<h4>安装hudson</h4>

<pre><code>找到http://hudson-ci.org/redhat/RPMS/noarch/ 最新hudson rpm 按住包

wget http://hudson-ci.org/redhat/RPMS/noarch/hudson-3.0.0-1.1.noarch.rpm
</code></pre>

<p>配置：安装完之后，你可以在/etc/sysconfig/hudson设置启动用户（涉及到执行构建的权限），hudson主目录。</p>

<h4>启动hudson</h4>

<pre><code>/sbin/service hudson start
</code></pre>

<p>open http://66.135.35.84:8080/
choose plugins to install and click <code>instann</code></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[网站攻击实例]]></title>
    <link href="http://dexterdeng.github.com/blog/2013/01/16/wang-zhan-gong-ji-shi-li/"/>
    <updated>2013-01-16T00:06:00+08:00</updated>
    <id>http://dexterdeng.github.com/blog/2013/01/16/wang-zhan-gong-ji-shi-li</id>
    <content type="html"><![CDATA[<pre><code>http://dev.blanee.com/recherche?city_id=city_32&amp;loc=Casablanca&amp;query=999999.9+union+all+select+0x31303235343830303536%2C0x31303235343830303536%2C0x31303235343830303536%2C0x31303235343830303536%2C0x31303235343830303536%2C0x31303235343830303536%2C0x31303235343830303536%2C0x31303235343830303536%2C0x31303235343830303536--
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[system备忘录]]></title>
    <link href="http://dexterdeng.github.com/blog/2013/01/15/systembei-wang-lu/"/>
    <updated>2013-01-15T15:24:00+08:00</updated>
    <id>http://dexterdeng.github.com/blog/2013/01/15/systembei-wang-lu</id>
    <content type="html"><![CDATA[<ul>
<li>要想fb功能work， 需要确保认证的cacert.pem 在/public/</li>
<li><p>以下配置需要视具体情况变更</p>

<p>ENV["MAGICK_CODER_MODULE_PATH"]="/usr/lib64/ImageMagick-6.7.0/modules-Q16/coders/"</p>

<p>ENV["GS_FONTPATH"] = "/usr/share/ghostscript/fonts"</p>

<h1>ENV["MAGICK_CONFIGURE_PATH"]="/usr/local/lib/ImageMagick-6.6.3/config"</h1>

<p>ENV["GS_LIB"] = "/usr/share/ghostscript/fonts"</p>

<p>Paperclip.options[:command_path] = "/usr/bin"
Paperclip.options[:swallow_stderr] = false</p></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[install tivoli]]></title>
    <link href="http://dexterdeng.github.com/blog/2013/01/15/install-tivoli/"/>
    <updated>2013-01-15T15:21:00+08:00</updated>
    <id>http://dexterdeng.github.com/blog/2013/01/15/install-tivoli</id>
    <content type="html"><![CDATA[<pre><code>rpm -ivh gsk*
rpm -ivh TIVsm-* tsm-6.2.2.6-P1MH8.x86_64.rpm
yum install compat-libstdc++-33
rpm -ivh TIVsm-* tsm-6.2.2.6-P1MH8.x86_64.rpm
/opt/tivoli/tsm/client/ba/bin/dsmconf
dsmc
/etc/rc.d/init.d/dsmcad restart
/etc/rc.d/init.d/dsmc restart
ps aux | grep dsmc
cat /opt/tivoli/tsm/client/ba/bin/dsmsched.log
/etc/rc.d/init.d/dsmcad restart
/etc/rc.d/init.d/dsmc restart
ps aux | grep dsmc
cat /opt/tivoli/tsm/client/ba/bin/dsmsched.log
cat /opt/tivoli/tsm/client/ba/bin/dsmsched.log
cat /opt/tivoli/tsm/client/ba/bin/dsmsched.log
</code></pre>
]]></content>
  </entry>
  
</feed>


<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>setup new environment - 脑波网</title>
  <meta name="author" content="Dexter Deng">

  
  <meta name="description" content="install RVM 安装系统需要的包 yum install build-essential openssl curl libcurl3-dev libreadline6 libreadline6-dev git zlib1g zlib1g-dev libssl-dev libyaml-dev &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://dexterdeng.github.com/blog/2013/01/07/setup-new-environment/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="脑波网" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">脑波网</a></h1>
  
    <h2>---- 记录我的足迹, 记录我的脑波, 我是Dexter Deng.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss email">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
    <li><a href="dexterdeng@gmail.com" rel="subscribe-email" title="subscribe via email">Email</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:dexterdeng.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">文章</a></li>
  <li><a href="/blog/archives">归档</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Setup New Environment</h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-01-07T13:32:00+08:00" pubdate data-updated="true">Jan 7<span>th</span>, 2013</time>
        
      </p>
    
  </header>


<div class="entry-content"><h3>install RVM</h3>

<h3>安装系统需要的包</h3>

<pre><code>yum install build-essential openssl curl libcurl3-dev libreadline6 libreadline6-dev git zlib1g zlib1g-dev libssl-dev libyaml-dev libxml2-dev libxslt-dev autoconf automake libtool imagemagick libmagickwand-dev libpcre3-dev libsqlite3-dev


yum install gcc-c++ 
yum install readline-devel
yum install zlib-devel 
yum install openssl-devel 
</code></pre>

<h3>安装mysql</h3>

<pre><code>yum install mysql mysql-server   mysql-devel.x86_64 
/sbin/service mysqld start
/sbin/chkconfig --list mysql
默认即可登陆， 账号root, 密码空
</code></pre>

<h3>安装imagemagick</h3>

<pre><code>yum install libtool-ltdl libtool-ltdl-devel freetype freetype-devel fontconfig-devel
</code></pre>

<p>Centos 5.x</p>

<pre><code>wget http://dl.fedoraproject.org/pub/epel/5/i386/epel-release-5-4.noarch.rpm
wget http://rpms.famillecollet.com/enterprise/remi-release-5.rpm
sudo rpm -Uvh remi-release-5*.rpm epel-release-5*.rpm
</code></pre>

<p>Centos 6.x</p>

<pre><code>wget http://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm
wget http://rpms.famillecollet.com/enterprise/remi-release-6.rpm
sudo rpm -Uvh remi-release-6*.rpm epel-release-6*.rpm
</code></pre>

<p>Contnue</p>

<pre><code>yum --enablerepo=epel install jasper jasper-libs jasper-devel

yum install OpenEXR-devel.i686 OpenEXR-libs.i686 OpenEXR-devel.x86_64 OpenEXR-libs.x86_64


yum install ImageMagick.x86_64 ImageMagick-devel.x86_64
yum remove ImageMagick  #这种方式可以安装很多依赖包。虽然不够优雅

yum install xz-devel.x86_64
yum install fftw3.x86_64 fftw3-devel.x86_64

wget http://www.imagemagick.org/download/linux/CentOS/x86_64/ImageMagick-6.8.1-9.x86_64.rpm
rpm -Uvh ImageMagick-6.8.1-9.x86_64.rpm

yum install freetype
yum install gd-devel
wget http://www.osresources.com/files/centos-windows-fonts/msfonts.tbz
mkdir /usr/share/fonts/default/TrueType
tar xvjpf msfonts.tbz -C /usr/share/fonts/default/TrueType/


yum install fftw3-devel fontconfig-devel libtool-ltdl-devel -y
/sbin/ldconfig  /usr/local/lib
</code></pre>

<p>=========================================</p>

<pre><code>以上步骤有问题。
把本库里ImageMagick.tar.gz里软件全部装好就可使用。 很简单。 rpm -Uvh
</code></pre>

<p>xx 是安装， rpm -e xxx 是卸载.</p>

<p>=========================================</p>

<pre><code>yum install curl.x86_64  curl-devel.x86_64 
gem install curb -v=0.7.8
gem install curb -v=0.7.7.1

yum install libxml++.x86_64 libxml2.x86_64  libxml2-devel.x86_64 libxslt.x86_64 libxslt-devel.x86_64
gem install google-spreadsheet-ruby -v=0.1.5
gem install nokogiri -v=1.5.0
gem install nokogiri -v=1.4.4
gem install nokogiri -v=1.4.3.1
gem install roo -v=1.9.6

yum install aspell.x86_64  aspell-devel.x86_64 enchant-aspell.x86_64
</code></pre>

<p>aspell-en.x86_64   aspell-fr.x86_64</p>

<pre><code>gem install raspell -v=1.2
</code></pre>

<h3>安装nginx</h3>

<h3>integrate passenger with nginx</h3>

<h4>Installing other dependencies</h4>

<p>Both Passenger and Nginx, as one would expect, have various dependencies. The list below is exhaustive for the configuration I outline, but if you compile more modules into Nginx then you may have to install additional prerequisites.</p>

<pre><code>$ apt-get install build-essential libpcre3-dev libssl-dev zlib1g
</code></pre>

<p>Nginx’s HTTP rewrite module requires the PCRE library sources, so it can parse regular expressions in location directives. It also needs the OpenSSL header files for SSL support, and zlib so that responses can be compressed.</p>

<h4>Installing the Passenger gem</h4>

<pre><code>gem install passenger

$ passenger-config --root
/usr/local/lib/ruby/gems/1.9.1/gems/passenger-3.0.17

$ PASSENGER_NGINX_DIR=`passenger-config --root`/ext/nginx
</code></pre>

<h4>Downloading the PCRE source</h4>

<h4>安装PCRE</h4>

<pre><code>$ cd /usr/local/src
$ wget ftp://ftp.csx.cam.ac.uk/pub/software/programming/pcre/pcre-8.31.tar.gz
$ tar -xzvf pcre-8.31.tar.gz
$ cd pcre-8.31
$ PCRE_DIR=`pwd`
</code></pre>

<h4>Compiling Nginx</h4>

<pre><code>$ cd /usr/local/src
$ wget http://nginx.org/download/nginx-1.2.4.tar.gz
$ tar -xzvf nginx-1.2.4.tar.gz
$ cd nginx-1.2.4
$ NGINX_SRC_DIR=`pwd`
</code></pre>

<p>安装</p>

<pre><code>$ ./configure \
  --prefix=/usr/local \
  --sbin-path=/usr/local/sbin \
  --conf-path=/etc/nginx/nginx.conf \
  --error-log-path=/var/log/nginx/error.log \
  --http-log-path=/var/log/nginx/access.log \
  --with-http_ssl_module \
  --with-http_gzip_static_module \
  --add-module=$PASSENGER_NGINX_DIR \
  --with-pcre=$PCRE_DIR \
  --with-http_sub_module \
  --with-http_realip_module   --with-http_stub_status_module 
$ make
$ make install
</code></pre>

<p>注意pcre和passenger的位置。 吧passenger编译进去。</p>

<p>编辑nginx</p>

<pre><code>$ chmod +x /etc/init.d/nginx
$ /usr/sbin/update-rc.d -f nginx defaults
</code></pre>

<p>复制conf</p>

<pre><code>$ cd $NGINX_SRC_DIR
$ cp -R conf /etc/nginx
$ mdkir /etc/nginx/conf.d
</code></pre>

<p>Then edit <code>/etc/nginx/nginx.conf</code> and add the following line before the end of the http block.</p>

<pre><code>include /etc/nginx/conf.d/*.conf;
</code></pre>

<p>增加. <code>/etc/nginx/conf.d/000-passenger.conf</code>并增加以下行， 确认具体路径。</p>

<pre><code>passenger_root /usr/local/lib/ruby/gems/1.9.1/gems/passenger-3.0.17; # passenger-config --root 可以输出路径
passenger_ruby /usr/local/bin/ruby;
</code></pre>

<p>最简配置</p>

<pre><code>server {
  listen 80;
  server_name myrackapp.net;
  root /var/www/myrackapp.net/public;
  passenger_enabled on;
  rails_env production;
}
</code></pre>

<p>确认：</p>

<pre><code>$ cd $NGINX_SRC_DIR
$ nginx -V
nginx version: nginx/1.2.4
built by gcc 4.4.3 (Ubuntu 4.4.3-4ubuntu5.1)
TLS SNI support enabled
configure arguments: --prefix=/usr/local --sbin-path=/usr/local/sbin
--conf-path=/etc/nginx/nginx.conf
--error-log-path=/var/log/nginx/error.log
--http-log-path=/var/log/nginx/access.log
--with-pcre=/usr/local/src/pcre-8.31
--add-module=/usr/local/lib/ruby/gems/1.9.1/gems/passenger-3.0.17/ext/nginx
--with-http_ssl_module --with-http_gzip_static_module
--with-http_sub_module
</code></pre>

<p>这样可以看到输出。</p>

<p>以上方法完全可以不用rvmsudo ..install_nginx….</p>

<h3>install memcache</h3>

<pre><code>wget http://pkgs.repoforge.org/rpmforge-release/rpmforge-release-0.5.2-2.el5.rf.x86_64.rpm
rpm -ivh rpmforge-release-0.5.2-2.el5.rf.x86_64.rpm 

yum install --enablerepo=rpmforge  memcached.x86_64 memcached-devel.x86_64 libmemcached.x86_64  libmemcached-devel.x86_64 libmemcache.x86_64 libmemcache-devel.x86_64  perl-Apache-Session-Memcached.noarch perl-Cache-Memcached.noarch perl-Memcached-libmemcached.x86_64 php-pecl-memcache.x86_64  php-pecl-memcached.x86_64  redis.x86_64 rubygem-moneta.noarch 

#用不了这么多， 我是图省事
</code></pre>

<h3>download the rvm</h3>

<pre><code>sudo gem update --system 1.3.7 or rvm install rubygems 1.3.7
</code></pre>

<h3>后续</h3>

<p>安装代码， capistrano，</p>

<h3>FAQ</h3>

<h4>每次更新数据库总会报错</h4>

<pre><code>Sphinx cannot be found on your system. You may need to configure the
following
settings in your config/sphinx.yml file:
  * bin_path
  * searchd_binary_name
  * indexer_binary_name
</code></pre>

<p>解决办法有两个：</p>

<ol>
<li>运行indexer,获得版本号， 然后在sphinx.yml里增加 version: 0.9.9
(e.g.)</li>
<li>升级使用版本较高的sphinx</li>
</ol>


<h4>没错rake都出现一条错</h4>

<pre><code>WARNING: 'require 'rake/rdoctask'' is deprecated.  Please use 'require 'rdoc/task' (in RDoc 2.4.2+)' instead.
at /usr/local/rvm/gems/ree-1.8.7-2011.03/gems/rake-0.9.2.2/lib/rake/rdoctask.rb
</code></pre>

<p>解决办法：</p>

<pre><code>gem install rdoc
</code></pre>

<p>编辑Rakefile</p>

<pre><code>#require 'rake/rdoctask'
require 'rdoc/task'
</code></pre>

<h4>sync files</h4>

<p>Local folder to remote folder, using a domain, an IP address and a server defined in the SSH configuration file:</p>

<pre><code>rsync -rtvz source_folder/ user@domain:/path/to/destination_folder/
rsync -rtvz source_folder/ user@xxx.xxx.xxx.xxx:/path/to/destination_folder/
rsync -rtvz source_folder/ server_name:/path/to/destination_folder/
</code></pre>

<p>Remote folder to local folder, using a domain, an IP address and a server defined in the SSH configuration file:</p>

<pre><code>rsync -rtvz user@domain:/path/to/source_folder/ destination_folder/
rsync -rtvz user@xxx.xxx.xxx.xxx:/path/to/source_folder/ destination_folder/
rsync -rtvz server_name:/path/to/source_folder/ destination_folder/


nohup rsync -rtvz blabla@66.66.66.66:/var/www/rails/blabla/shared/uploads  /var/www/rails/blabla/shared
# copy uploads to shared/uploads.  
#fast. and continual, 25G, 5 hours. 
</code></pre>

<p>exclude folders</p>

<pre><code>rsync -rtv --exclude 'directory' source_folder/ destination_folder/
rsync -rtv --exclude 'file.txt' source_folder/ destination_folder/
rsync -rtv --exclude 'path/to/directory' source_folder/ destination_folder/
rsync -rtv --exclude 'path/to/file.txt' source_folder/ destination_folder/
</code></pre>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Dexter Deng</span></span>

      








  


<time datetime="2013-01-07T13:32:00+08:00" pubdate data-updated="true">Jan 7<span>th</span>, 2013</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/system/'>system</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://dexterdeng.github.com/blog/2013/01/07/setup-new-environment/" data-via="dexterdeng" data-counturl="http://dexterdeng.github.com/blog/2013/01/07/setup-new-environment/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2013/01/07/%5B%3F%5D-dian-jing-yan-jiao-xun/" title="Previous Post: 一点经验教训">&laquo; 一点经验教训</a>
      
      
        <a class="basic-alignment right" href="/blog/2013/01/13/about-mail-server/" title="Next Post: about Mail Server">about Mail Server &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/01/15/install-tivoli/">install tivoli</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/01/15/configure-php-plus-nginx/">configure php + nginx </a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/01/15/postfix-mailq-cao-zuo/">postfix mailq 操作</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/01/13/about-mail-server/">about Mail Server</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/01/07/setup-new-environment/">setup new environment</a>
      </li>
    
  </ul>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating...</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("dexterdeng", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/dexterdeng" class="twitter-follow-button" data-show-count="false">Follow @dexterdeng</a>
  
</section>



<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/dexterdeng?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Dexter Deng -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'dexterdengsblog';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://dexterdeng.github.com/blog/2013/01/07/setup-new-environment/';
        var disqus_url = 'http://dexterdeng.github.com/blog/2013/01/07/setup-new-environment/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
